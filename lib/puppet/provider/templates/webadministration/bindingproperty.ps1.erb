<%- if resource[:bindings] %>

$binding = Get-WebBinding -Name <%= resource['name'] %> | Remove-WebBinding

  <% resource[:bindings].each do |bind| -%>
<% ip, port, host_header = resource.provider.divide_binding_information(bind) %>

    <%- unless ( bind['protocol'] == 'https' and bind['sslflags'] ) %>
New-WebBinding -Name '<%= resource['name'] %>'  -Protocol '<%= bind['protocol'] %>' -IPAddress <%= ip %> -Port <%= port %> -HostHeader '<%= host_header %>' -Force -ErrorAction Stop

    <%- else %>
New-WebBinding -name '<%= resource['name'] %>' -Protocol '<%= bind['protocol'] %>' -IPAddress '<%= ip %>' -Port '<%= port %>' -HostHeader '<%= host_header %>' -SslFlags '<%= bind['sslflags'] %>' -Force -ErrorAction Stop

$binding = Get-WebBinding -Name <%= resource['name'] %> -Protocol <%= bind['protocol'] %> -IPAddress '<%= ip %>' -Port '<%= port %>' -HostHeader '<%= host_header %>'
      if ( $binding ) {
$binding.AddSslCertificate('<%= bind['certificatehash'] %>', '<%= bind['certificatestorename'] %>')
      }
    <%- end %>
  <% end %>
<% end %>
